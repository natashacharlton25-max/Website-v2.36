---
import '../styles/global.css';
import '../styles/themes/Preview/coretokens.css';
import GlassNav from '../components/Nav/NavBar/GlassNav.astro';
import FooterWithMask from '../components/Footer/FooterWithMask.astro';
import CookieBanner from '../components/Global/CookieBanner.astro';
import MiniCart from '../components/Shop/MiniCart.astro';
import AccessibilityPanel from '../components/A11y/AccessibilityPanel.astro';
import SideTabs from '../components/Nav/Tabs/SideTabs.astro';
import SearchOverlay from '../components/Search/SearchOverlay.astro';
import ContactPopup from '../components/ContactForm/Contact-Popup.astro';
import CustomScrollbar from '../components/Global/CustomScrollbar.astro';
import { BRAND_CONFIG } from '../lib/config/brand';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  hideFooter?: boolean;
}

const {
  title = BRAND_CONFIG.seo.defaultTitle,
  description = BRAND_CONFIG.seo.defaultDescription,
  image = BRAND_CONFIG.seo.defaultImage,
  hideFooter = false
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={image}>

  <!-- Twitter/X sharing -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={image}>

  <title>{title}</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/Logo/Favicon.png">

  <!-- Font imports are now handled in src/Styles/fonts.css -->

  <!-- Font Awesome (for icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Lottie Player for animated icons -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <!-- Local fonts loaded via global.css @import -->
</head>
<body data-btn-theme="flat">
  <!-- Skip Links (site-wide accessibility) -->
  <nav class="skip-links" aria-label="Skip links">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#main-nav" class="skip-link">Skip to navigation</a>
  </nav>

  <!-- Navigation -->
  <GlassNav />

  <!-- Main Content -->
  <main id="main-content">
    <slot />
  </main>

  <!-- Footer -->
  {!hideFooter && (
    <FooterWithMask />
  )}

  <!-- Cookie Consent Banner -->
  <CookieBanner />

  <!-- Toast Notifications Container (toasts are shown dynamically via JavaScript) -->
  <div id="toast-container"></div>

  <!-- Mini Cart Dropdown -->
  <MiniCart />

  <!-- Accessibility Panel (modal for settings) -->
  <AccessibilityPanel />

  <!-- Side Tabs (email, share, accessibility) -->
  <SideTabs />

  <!-- Search Overlay -->
  <SearchOverlay />

  <!-- Custom Scrollbar - brand styled native scrollbar -->
  <CustomScrollbar />

  <!-- Global Scripts -->
  <script>
    // Import toast notification system
    import { showToast } from '../lib/ui/toast';
    // Import scroll animations (GSAP ScrollTrigger)
    import '../lib/animation/scroll-animations';
    // Import smooth scroll (handles anchor links)
    import '../lib/ui/smooth-scroll';
    // Import theme switcher for accessibility themes
    import '../scripts/ThemeSwitcher.js';
    // Import theme preview card renderer
    import '../styles/themes/Preview/ThemePreviewTokens.js';

    // Make showToast globally available
    (window as any).showToast = showToast;

    // Global add-to-cart handler
    document.addEventListener('click', function(e) {
      const target = e.target as HTMLElement;
      if (target.matches('.add-to-cart-btn') || target.closest('.add-to-cart-btn')) {
        const button = target.matches('.add-to-cart-btn') ? target : target.closest('.add-to-cart-btn');
        if (!button) return;

        const productId = button.getAttribute('data-product-id');
        const productName = button.getAttribute('data-product-name');
        const productPrice = parseFloat(button.getAttribute('data-product-price') || '0');
        const productImage = button.getAttribute('data-product-image');

        if (productId && productName && (window as any).cart) {
          (window as any).cart.addItem({
            id: productId,
            name: productName,
            price: productPrice,
            image: productImage || '/placeholder.jpg'
          });
        }
      }
    });
  </script>

  <!-- Analytics Placeholder -->
  <script>
    // Add your analytics code here (Google Analytics, Plausible, etc.)
    // Only load if user has given analytics consent
    const consent = (window as any).getCookieConsent?.();
    if (consent?.analytics) {
      // Initialize analytics
      console.log('Analytics enabled');
    }
  </script>
</body>
</html>
