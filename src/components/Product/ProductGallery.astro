---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  mainImage: ImageMetadata;
  galleryImages?: ImageMetadata[];
  productName: string;
  badge?: string;
  badgeType?: string;
}

const { mainImage, galleryImages = [], productName, badge, badgeType = 'default' } = Astro.props;
---

<div class="product-gallery">
  <div class="main-image">
    <Image
      src={galleryImages.length > 0 ? galleryImages[0] : mainImage}
      alt={productName}
      id="main-product-image"
    />
    {badge && (
      <div class={`product-badge badge-${badgeType}`}>{badge}</div>
    )}
  </div>

  {galleryImages.length > 0 && (
    <div class="thumbnail-gallery">
      {galleryImages.map((img, index) => (
        <button
          class={`thumbnail ${index === 0 ? 'active' : ''}`}
          data-image={img.src}
          type="button"
          aria-label={`View ${productName} image ${index + 1}`}
        >
          <Image src={img} alt={`${productName} preview ${index + 1}`} />
        </button>
      ))}
    </div>
  )}
</div>

<script>
  // Thumbnail gallery image switching
  const thumbnails = document.querySelectorAll('.thumbnail');
  const mainImage = document.getElementById('main-product-image') as HTMLImageElement;

  thumbnails.forEach(thumbnail => {
    thumbnail.addEventListener('click', () => {
      // Remove active class from all thumbnails
      thumbnails.forEach(t => t.classList.remove('active'));

      // Add active class to clicked thumbnail
      thumbnail.classList.add('active');

      // Get the image source from data attribute
      const newImageSrc = thumbnail.getAttribute('data-image');

      // Update main image
      if (mainImage && newImageSrc) {
        mainImage.src = newImageSrc;
      }
    });
  });
</script>

<style>
  .product-gallery {
    position: relative;
  }

  .main-image {
    position: relative;
    width: 100%;
    aspect-ratio: 3 / 4;
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    background-color: var(--color-Background-100);
    margin-bottom: var(--space-lg);
  }

  .main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-badge {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    padding: var(--space-xs) var(--space-md);
    background-color: var(--color-Primary-600);
    color: white;
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--border-radius-md);
  }

  .badge-worksheet {
    background-color: var(--color-Primary-600);
  }

  .badge-guide {
    background-color: var(--color-Secondary-600);
  }

  .badge-toolkit {
    background-color: var(--color-Accent-600);
  }

  .thumbnail-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: var(--space-sm);
  }

  .thumbnail {
    aspect-ratio: 3 / 4;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    background-color: var(--color-Background-100);
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition-base);
    padding: 0;
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .thumbnail:hover {
    border-color: var(--color-Primary-400);
  }

  .thumbnail.active {
    border-color: var(--color-Primary-600);
    box-shadow: 0 0 0 1px var(--color-Primary-600);
  }

  .thumbnail:focus-visible {
    outline: 2px solid var(--color-Primary-600);
    outline-offset: 2px;
  }
</style>
