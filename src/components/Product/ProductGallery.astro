---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  mainImage: ImageMetadata;
  galleryImages?: ImageMetadata[];
  productName: string;
  badge?: string;
  badgeType?: string;
}

const { mainImage, galleryImages = [], productName, badge, badgeType = 'default' } = Astro.props;

// Combine into single array - use galleryImages if available, otherwise use mainImage
const allImages = galleryImages && galleryImages.length > 0
  ? galleryImages
  : [mainImage];
---

<div class="product-gallery">
  <div class="thumbnail-gallery">
    {allImages.map((img, index) => (
      <button
        class={`thumbnail ${index === 0 ? 'is-active' : 'is-inactive'}`}
        type="button"
        aria-label={`View ${productName} image ${index + 1}`}
      >
        <Image src={img} alt={`${productName} preview ${index + 1}`} />
        {index === 0 && badge && (
          <div class={`product-badge badge-${badgeType}`}>{badge}</div>
        )}
      </button>
    ))}
  </div>
</div>

<style>
  .product-gallery {
    position: relative;
  }

  .thumbnail-gallery {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: var(--space-md);
    grid-auto-flow: dense;
  }

  .thumbnail {
    cursor: pointer;
    overflow: hidden;
    border-radius: var(--border-radius-md);
    background-color: var(--color-Background-100);
    grid-column: span 2;
    box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.017),
      0 6.7px 5.3px rgba(0, 0, 0, 0.024), 0 12.5px 10px rgba(0, 0, 0, 0.03),
      0 22.3px 17.9px rgba(0, 0, 0, 0.036), 0 41.8px 33.4px rgba(0, 0, 0, 0.043),
      0 100px 80px rgba(0, 0, 0, 0.06);
    height: 250px;
    padding: 0;
    border: 2px solid var(--color-Neutral-200);
    position: relative;
  }

  .thumbnail.is-active {
    grid-row: 1;
    grid-column: 1 / span 6;
    height: 450px;
    order: 0;
  }

  .thumbnail.is-inactive {
    grid-column: span 2;
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .thumbnail:hover {
    border-color: var(--color-Primary-400);
  }

  .thumbnail:focus-visible {
    outline: 2px solid var(--color-Primary-600);
    outline-offset: 2px;
  }

  .product-badge {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    padding: var(--space-xs) var(--space-md);
    background-color: var(--color-Primary-600);
    color: white;
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--border-radius-md);
    pointer-events: none;
    z-index: 1;
  }

  .badge-worksheet {
    background-color: var(--color-Primary-600);
  }

  .badge-guide {
    background-color: var(--color-Secondary-600);
  }

  .badge-toolkit {
    background-color: var(--color-Accent-600);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .thumbnail-gallery {
      grid-template-columns: 1fr !important;
    }

    .thumbnail {
      grid-column: span 1 !important;
    }

    .thumbnail.is-active {
      grid-column: 1 / span 1 !important;
    }
  }

  @media (min-width: 641px) and (max-width: 1024px) {
    .thumbnail-gallery {
      grid-template-columns: repeat(4, 1fr);
    }

    .thumbnail {
      grid-column: span 2;
    }

    .thumbnail.is-active {
      grid-column: 1 / span 4;
    }
  }
</style>
