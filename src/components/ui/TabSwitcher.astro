---
/**
 * Tab Switcher Component
 *
 * A modern tab navigation with sliding indicator
 *
 * Props:
 * - tabs: Array of { id: string, label: string, icon?: string }
 * - defaultActive?: string (id of default active tab)
 */

export interface Tab {
  id: string;
  label: string;
  icon?: string; // SVG icon as string
}

interface Props {
  tabs: Tab[];
  defaultActive?: string;
}

const { tabs, defaultActive } = Astro.props;
const activeTab = defaultActive || tabs[0]?.id;
---

<div class="switcher-container">
  <div class="switcher-nav">
    {tabs.map((tab, index) => (
      <button
        class={`switcher-btn ${tab.id === activeTab ? 'active' : ''}`}
        data-tab={tab.id}
      >
        {tab.icon && <span set:html={tab.icon} />}
        <span>{tab.label}</span>
      </button>
    ))}
  </div>
</div>

<script>
  // Elastic Tab/Switcher functionality
  const tabButtons = document.querySelectorAll('.switcher-btn');
  const switcherNav = document.querySelector('.switcher-nav') as HTMLElement;

  // Function to update selector position
  function updateSelector(activeButton: HTMLElement) {
    if (!switcherNav) return;

    const activeWidth = activeButton.offsetWidth;
    const activeLeft = activeButton.offsetLeft;

    // Update CSS custom properties for the selector
    switcherNav.style.setProperty('--selector-width', `${activeWidth}px`);
    switcherNav.style.setProperty('--selector-left', `${activeLeft}px`);
  }

  // Initialize selector on page load
  const activeButton = document.querySelector('.switcher-btn.active') as HTMLElement;
  if (activeButton && switcherNav) {
    // Delay to ensure layout is complete
    setTimeout(() => {
      updateSelector(activeButton);
    }, 100);
  }

  // Handle tab clicks
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      const targetTab = (button as HTMLElement).dataset.tab;

      // Remove active class from all buttons
      tabButtons.forEach(btn => btn.classList.remove('active'));

      // Add active class to clicked button
      button.classList.add('active');
      updateSelector(button as HTMLElement);

      // Dispatch custom event for parent component to handle
      const event = new CustomEvent('tabchange', {
        detail: { tabId: targetTab },
        bubbles: true
      });
      button.dispatchEvent(event);
    });
  });

  // Update selector on window resize
  window.addEventListener('resize', () => {
    const activeBtn = document.querySelector('.switcher-btn.active') as HTMLElement;
    if (activeBtn) {
      updateSelector(activeBtn);
    }
  });
</script>

<style>
  /* Elastic Tabs Navigation */
  .switcher-container {
    display: flex;
    justify-content: center;
    margin-bottom: var(--space-3xl);
  }

  .switcher-nav {
    font-size: var(--text-sm);
    padding: var(--space-xs) var(--space-md);
    list-style: none;
    background: var(--color-AccentOne-100);
    box-shadow: var(--shadow-lg);
    display: inline-flex;
    border-radius: 50px;
    position: relative;
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
  }

  .switcher-nav::-webkit-scrollbar {
    display: none; /* Chrome, Safari */
  }

  .switcher-btn {
    text-decoration: none;
    color: var(--color-Text-600);
    text-transform: uppercase;
    padding: var(--space-md) var(--space-lg);
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    position: relative;
    z-index: 2;
    transition: color 0.6s;
    background: transparent;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    font-weight: var(--font-semibold);
    font-size: var(--text-sm);
  }

  .switcher-btn :global(svg) {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
  }

  .switcher-btn.active {
    color: white;
  }

  .switcher-btn:hover:not(.active) {
    color: var(--color-Primary-600);
  }

  /* Sliding Selector Background */
  .switcher-nav::before {
    content: '';
    height: 75%;
    display: inline-block;
    position: absolute;
    left: var(--selector-left, 0);
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;
    border-radius: 50px;
    width: var(--selector-width, 0);
    transition: left 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                width 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    background: var(--color-AccentOne-500);
    box-shadow: var(--shadow-md);
  }

  /* Responsive: Mobile */
  @media (max-width: 768px) {
    .switcher-container {
      padding: 0 !important;
    }

    .switcher-nav {
      flex-direction: column !important;
      align-items: stretch !important;
      padding: var(--space-sm) !important;
      overflow-x: visible !important;
      gap: var(--space-xs) !important;
      display: flex !important;
      border-radius: 6px !important;
    }

    .switcher-btn {
      width: 100% !important;
      justify-content: flex-start !important;
      padding: var(--space-md) var(--space-lg) !important;
      text-align: left !important;
      display: inline-flex !important;
    }

    .switcher-btn span {
      display: inline !important; /* Show text labels */
    }

    .switcher-nav::before {
      display: none !important; /* Hide horizontal sliding selector */
    }

    .switcher-btn.active {
      background: var(--color-AccentOne-500) !important;
      border-radius: 6px !important;
    }
  }

  @media (max-width: 480px) {
    .switcher-btn {
      padding: var(--space-xs) var(--space-sm);
    }
  }

  @media (max-width: 300px) {
    .switcher-nav {
      padding: var(--space-xs) !important;
      gap: 4px !important;
      border-radius: 6px !important;
    }

    .switcher-btn {
      padding: var(--space-xs) var(--space-sm) !important;
      font-size: 11px !important;
      gap: 6px !important;
    }

    .switcher-btn :global(svg) {
      width: 16px !important;
      height: 16px !important;
    }

    .switcher-btn.active {
      border-radius: 4px !important;
    }
  }

  @media (max-width: 200px) {
    .switcher-nav {
      padding: var(--space-xs) !important;
      align-items: center !important;
      border-radius: 6px !important;
    }

    .switcher-btn {
      padding: var(--space-xs) !important;
      justify-content: center !important;
    }

    .switcher-btn span {
      display: none !important; /* Hide text, show only icons */
    }

    .switcher-btn :global(svg) {
      width: 16px !important;
      height: 16px !important;
    }

    .switcher-btn.active {
      border-radius: 4px !important;
    }
  }
</style>
