---
/**
 * SharePanel - Sticky floating share buttons panel
 *
 * A fixed-position side panel with social share buttons that link to the current page.
 * Inspired by the AccessibilityPanel design pattern.
 *
 * Usage:
 * ```astro
 * <SharePanel position="left" />
 * ```
 */

interface Props {
  /**
   * Position of the share panel
   */
  position?: 'left' | 'right';

  /**
   * Additional class for styling
   */
  class?: string;
}

const {
  position = 'left',
  class: className = ''
} = Astro.props;
---

<!-- Share Panel - Bottom Right -->
<div class={`share-panel ${className}`}>
  <!-- Copy Link -->
  <button
    type="button"
    class="share-panel__btn share-panel__btn--copy"
    data-share="copy"
    aria-label="Copy link to clipboard"
  >
    <lottie-player
      src="/Animated Icons/Share/share.json"
      background="transparent"
      speed="1"
      style="width: 32px; height: 32px;"
      loop
      aria-hidden="true"
    ></lottie-player>
  </button>
</div>

<style>
  /* Share Panel Container - Bottom Right */
  .share-panel {
    position: fixed;
    bottom: 90px; /* Above accessibility button */
    right: 0;
    z-index: 900;
    transition: all var(--transition-base);
  }

  /* Share Button */
  .share-panel__btn {
    width: 56px;
    height: 56px;
    border: none;
    background: var(--color-Background-100); /* Beige/cream */
    color: var(--color-Text-700);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    box-shadow: var(--shadow-md);
    position: relative;
    padding: 0;
    border-radius: var(--border-radius-md) 0 0 var(--border-radius-md);
  }

  .share-panel__btn:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-lg);
    background: var(--color-Primary-500);
  }

  .share-panel__btn:active {
    transform: scale(0.95);
  }

  /* Lottie player styling */
  .share-panel__btn lottie-player {
    pointer-events: none;
  }

  /* Copy success state */
  .share-panel__btn--copy.copied {
    background: var(--color-AccentTwo-600);
  }

  /* Responsive positioning */
  @media (max-width: 1400px) {
    .share-panel {
      bottom: 90px;
      right: 0;
    }
  }

  /* Hide on mobile */
  @media (max-width: 768px) {
    .share-panel {
      display: none;
    }
  }

  /* Print - Hide */
  @media print {
    .share-panel {
      display: none !important;
    }
  }
</style>

<script>
  // Share Panel Functionality
  function initSharePanel() {
    const copyButton = document.querySelector('[data-share="copy"]');
    if (!copyButton) return;

    // Get the lottie player inside this button
    const lottiePlayer = copyButton.querySelector('lottie-player') as any;

    // Hover to play animation
    if (lottiePlayer) {
      copyButton.addEventListener('mouseenter', () => {
        if (typeof lottiePlayer.play === 'function') {
          lottiePlayer.play();
        }
      });

      copyButton.addEventListener('mouseleave', () => {
        if (typeof lottiePlayer.stop === 'function') {
          lottiePlayer.stop();
        }
      });
    }

    // Click handler for copying link
    copyButton.addEventListener('click', () => {
      const url = window.location.href;

      navigator.clipboard.writeText(url).then(() => {
        // Add copied state
        copyButton.classList.add('copied');

        // Show toast notification if available
        if ((window as any).showToast) {
          (window as any).showToast({
            message: 'Link copied to clipboard!',
            theme: 'professional',
            animation: 'slide',
            duration: 3000
          });
        }

        // Remove copied state after 2 seconds
        setTimeout(() => {
          copyButton.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy link:', err);
        if ((window as any).showToast) {
          (window as any).showToast({
            message: 'Failed to copy link',
            theme: 'brutalist',
            animation: 'slide',
            duration: 3000
          });
        }
      });
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSharePanel);
  } else {
    initSharePanel();
  }
</script>
