---
/**
 * Basic Filter Switcher Component (No Animations)
 *
 * A simple filter navigation with sliding indicator - NO FLIP ANIMATIONS
 * Use this as a fallback or when you don't need animations
 *
 * Props:
 * - tabs: Array of { id: string, label: string, icon?: string }
 * - defaultActive?: string (id of default active tab)
 * - targetSelector: CSS selector for elements to filter (e.g., '.product-card')
 * - filterAttribute: Attribute name to match against (e.g., 'data-type')
 */

export interface FilterTab {
  id: string;
  label: string;
  icon?: string; // SVG icon as string
}

interface Props {
  tabs: FilterTab[];
  defaultActive?: string;
  targetSelector: string;
  filterAttribute: string;
}

const { tabs, defaultActive, targetSelector, filterAttribute } = Astro.props;
const activeTab = defaultActive || tabs[0]?.id;
---

<div class="filter-switcher-container">
  <div
    class="filter-switcher-nav"
    data-target-selector={targetSelector}
    data-filter-attribute={filterAttribute}
  >
    {tabs.map((tab) => (
      <button
        class={`filter-switcher-btn ${tab.id === activeTab ? 'active' : ''}`}
        data-filter={tab.id}
      >
        {tab.icon && <span set:html={tab.icon} />}
        <span>{tab.label}</span>
      </button>
    ))}
  </div>
</div>

<script>
  // Basic filter functionality - NO ANIMATIONS
  const filterNav = document.querySelector('.filter-switcher-nav');
  const filterButtons = document.querySelectorAll('.filter-switcher-btn');

  // Get target selector and filter attribute from data attributes
  const targetSelector = filterNav.dataset.targetSelector;
  const filterAttribute = filterNav.dataset.filterAttribute;
  const targetElements = document.querySelectorAll(targetSelector);

  // Function to update selector position
  function updateSelector(activeButton) {
    if (!filterNav) return;

    const activeWidth = activeButton.offsetWidth;
    const activeLeft = activeButton.offsetLeft;

    // Update CSS custom properties for the selector
    filterNav.style.setProperty('--selector-width', `${activeWidth}px`);
    filterNav.style.setProperty('--selector-left', `${activeLeft}px`);
  }

  // Initialize selector on page load - wait for layout to be ready
  const activeButton = document.querySelector('.filter-switcher-btn.active');

  function initializeSelector() {
    if (activeButton && filterNav) {
      updateSelector(activeButton);
    }
  }

  // Wait for fonts to load, then calculate position
  if (activeButton && filterNav) {
    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(() => {
        requestAnimationFrame(() => {
          requestAnimationFrame(initializeSelector);
        });
      });
    } else {
      // Fallback for browsers without font loading API
      requestAnimationFrame(() => {
        requestAnimationFrame(initializeSelector);
      });
    }

    // Also recalculate after full page load (in case fonts/images delay layout)
    window.addEventListener('load', () => {
      requestAnimationFrame(initializeSelector);
    });
  }

  // Handle filter clicks - BASIC FILTERING ONLY
  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filterId = button.dataset.filter;

      // Remove active class from all buttons
      filterButtons.forEach(btn => btn.classList.remove('active'));

      // Add active class to clicked button
      button.classList.add('active');
      updateSelector(button);

      // Emit custom event for external listeners
      const event = new CustomEvent('tabchange', {
        detail: { tabId: filterId },
        bubbles: true
      });
      button.dispatchEvent(event);

      // BASIC FILTERING - Just show/hide elements
      // Grid will automatically rearrange with CSS
      targetElements.forEach(element => {
        const elementValue = element.getAttribute(filterAttribute);
        const shouldShow = filterId === 'all' || elementValue === filterId;
        (element as HTMLElement).style.display = shouldShow ? '' : 'none';
      });
    });
  });

  // Update selector on window resize
  window.addEventListener('resize', () => {
    const activeBtn = document.querySelector('.filter-switcher-btn.active');
    if (activeBtn) {
      updateSelector(activeBtn);
    }
  });
</script>

<style>
  /* Filter Switcher Navigation */
  .filter-switcher-container {
    display: flex;
    justify-content: center;
    margin-bottom: var(--space-3xl);
  }

  .filter-switcher-nav {
    font-size: var(--text-sm);
    padding: var(--space-xs) var(--space-md);
    list-style: none;
    background: var(--color-AccentOne-100);
    box-shadow: var(--shadow-lg);
    display: inline-flex;
    border-radius: 50px;
    position: relative;
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
  }

  .filter-switcher-nav::-webkit-scrollbar {
    display: none; /* Chrome, Safari */
  }

  .filter-switcher-btn {
    text-decoration: none;
    color: var(--color-Text-600);
    text-transform: uppercase;
    padding: var(--space-md) var(--space-lg);
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    position: relative;
    z-index: 2;
    transition: color 0.6s;
    background: transparent;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    font-weight: var(--font-semibold);
    font-size: var(--text-sm);
  }

  .filter-switcher-btn :global(svg) {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
  }

  .filter-switcher-btn.active {
    color: white;
  }

  .filter-switcher-btn:hover:not(.active) {
    color: var(--color-Primary-600);
  }

  /* Sliding Selector Background */
  .filter-switcher-nav::before {
    content: '';
    height: 75%;
    display: inline-block;
    position: absolute;
    left: var(--selector-left, 0);
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;
    border-radius: 50px;
    width: var(--selector-width, 0);
    transition: left 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                width 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    background: var(--color-AccentOne-500);
    box-shadow: var(--shadow-md);
  }

  /* Responsive: Mobile */
  @media (max-width: 768px) {
    .filter-switcher-container {
      padding: 0 !important;
    }

    .filter-switcher-nav {
      flex-direction: column !important;
      align-items: stretch !important;
      padding: var(--space-sm) !important;
      overflow-x: visible !important;
      gap: var(--space-xs) !important;
      display: flex !important;
      border-radius: 6px !important;
    }

    .filter-switcher-btn {
      width: 100% !important;
      justify-content: flex-start !important;
      padding: var(--space-md) var(--space-lg) !important;
      text-align: left !important;
      display: inline-flex !important;
    }

    .filter-switcher-btn span {
      display: inline !important; /* Show text labels */
    }

    .filter-switcher-nav::before {
      display: none !important; /* Hide horizontal sliding selector */
    }

    .filter-switcher-btn.active {
      background: var(--color-AccentOne-500) !important;
      border-radius: 6px !important;
    }
  }

  @media (max-width: 480px) {
    .filter-switcher-btn {
      padding: var(--space-xs) var(--space-sm);
    }
  }

  @media (max-width: 300px) {
    .filter-switcher-nav {
      padding: var(--space-xs) !important;
      gap: 4px !important;
      border-radius: 6px !important;
    }

    .filter-switcher-btn {
      padding: var(--space-xs) var(--space-sm) !important;
      font-size: 11px !important;
      gap: 6px !important;
    }

    .filter-switcher-btn :global(svg) {
      width: 16px !important;
      height: 16px !important;
    }

    .filter-switcher-btn.active {
      border-radius: 4px !important;
    }
  }

  @media (max-width: 200px) {
    .filter-switcher-nav {
      padding: var(--space-xs) !important;
      align-items: center !important;
      border-radius: 6px !important;
    }

    .filter-switcher-btn {
      padding: var(--space-xs) !important;
      justify-content: center !important;
    }

    .filter-switcher-btn span {
      display: none !important; /* Hide text, show only icons */
    }

    .filter-switcher-btn :global(svg) {
      width: 16px !important;
      height: 16px !important;
    }

    .filter-switcher-btn.active {
      border-radius: 4px !important;
    }
  }
</style>
