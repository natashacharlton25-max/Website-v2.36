---
interface Props {
  line1?: string;
  line2?: string;
  words?: string[];
}

const {
  line1 = "UPGRADE",
  line2 = "YOUR",
  words = ["LIFE","FOCUS","POWER","ENERGY","ALIGNMENT","CLARITY","PURPOSE","RHYTHM","GROWTH","SOLUTIONS","TRUTH","LOVE","HARMONY","JOURNEY","CYCLE","INTUITION","EXPANSION","INTENTION","VIBRATION","LIFE"]
} = Astro.props;
---
<section class="upgrade-hero" data-words={JSON.stringify(words)}>
  <div class="container">
    <div class="line line1">{line1}</div>
    <div class="line line2">{line2}</div>
    <div class="rotatingText">
      <span class="rotator"></span>
    </div>
  </div>

  <style>
    :root {
      --hero-color-primary: #184e77;
      --hero-color-accent: #e63961;
      --hero-color-glow: rgba(230, 57, 97, 0.3);
    }

    .upgrade-hero {
      height: 700px;
      background: transparent;
      font-family: 'Poppins', sans-serif;
      display: flex; align-items: flex-start; justify-content: flex-start;
      padding: 30px; box-sizing: border-box;
    }
    .upgrade-hero .container { position: relative; text-align: left; overflow: visible; flex-shrink: 0; padding-left: 40px; box-sizing: border-box; }
    .upgrade-hero .line { font-size: clamp(48px, 12vw, 200px); font-weight: 800; color: var(--hero-color-primary); opacity: 0; animation: fadeIn .7s ease-out forwards; line-height: 1; margin-bottom: .3em; }
    .upgrade-hero .line.line1 { animation-delay: .7s; }
    .upgrade-hero .line.line2 { animation-delay: 1.4s; }
    @keyframes fadeIn { to { opacity: 1; } }
    .upgrade-hero .rotatingText { position: relative; display: inline-block; font-size: clamp(48px, 12vw, 200px); height: 1.4em; perspective: 1000px; opacity: 0; animation: fadeIn .7s ease-out forwards; animation-delay: 1.4s; overflow: visible; line-height: 1; }
    .upgrade-hero .rotator { display: inline-block; transform-origin: center bottom; backface-visibility: hidden; white-space: nowrap; font-weight: 800; color: var(--hero-color-accent); text-shadow: 0 0 12px var(--hero-color-glow); }
    @media (max-width: 768px) { .upgrade-hero { height: 350px; } .upgrade-hero .container { padding-left: 0; margin-left: -30px; } }
  </style>

  <script is:inline>
    const root = document.querySelector('.upgrade-hero');
    const words = root ? JSON.parse(root.dataset.words || '[]') : [];

    function initRotatingText() {
      const root = document.querySelector('.upgrade-hero');
      if (!root) return;

      const slot = root.querySelector('.rotator');
      const rotatingEl = root.querySelector('.rotatingText');
      if (!(slot instanceof HTMLElement) || !(rotatingEl instanceof HTMLElement)) return;

      let index = 0, maxW = 0;

      function showNext() {
        const isLast = index === words.length - 1;
        slot.textContent = words[index];

        const EXTRA = window.innerWidth < 768 ? 0 : 40;
        const w = slot.getBoundingClientRect().width + EXTRA;
        if (w > maxW) {
          maxW = Math.ceil(w);
          rotatingEl.style.width = `${maxW}px`;
        }

        const frames = isLast
          ? [
              { transform: 'rotateX(-90deg)', opacity: 0 },
              { transform: 'rotateX(0deg)',   opacity: 1 },
              { transform: 'rotateX(0deg)',   opacity: 1 }
            ]
          : [
              { transform: 'rotateX(-90deg)', opacity: 0 },
              { transform: 'rotateX(0deg)',   opacity: 1 },
              { transform: 'rotateX(0deg)',   opacity: 1 },
              { transform: 'rotateX(90deg)',  opacity: 0 }
            ];

        if (slot) {
          slot.animate(frames, { duration: 2000, easing: 'ease-in-out', fill: 'forwards' })
            .onfinish = () => {
              if (!isLast) { index++; setTimeout(showNext, 1000); }
            };
        }
      }

      setTimeout(showNext, 2000);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initRotatingText);
    } else {
      initRotatingText();
    }
  </script>
</section>
