---
/**
 * UnifiedButton - A single button component that can switch between different button styles
 *
 * This acts as a "bridge" - use this component everywhere and switch the style globally
 * by setting the `buttonStyle` in the site config, or per-button with the `style` prop.
 *
 * Available styles:
 * - 'base': BaseButton - solid colors, standard look
 * - 'outline': OutlineButton - border with fill on hover
 * - 'gradiglow': GradiGlow - gradient borders with glow effects
 * - 'colourflow': ColourFlowButton - glassmorphic with animated color flow
 * - 'slide': SlideColourButton - sliding color animation with icon
 * - 'neumorphic': NeumorphicButton - soft shadows, raised/pressed
 * - 'empower': EmpowerButton - tray-style with variants
 *
 * Usage:
 * ```astro
 * <!-- Use default style from config -->
 * <UnifiedButton variant="primary">Click Me</UnifiedButton>
 *
 * <!-- Override with specific style -->
 * <UnifiedButton variant="primary" style="gradiglow">Fancy Button</UnifiedButton>
 * ```
 *
 * To change site-wide default, edit src/config/button-config.ts
 */

import BaseButton from './BaseButton.astro';
import OutlineButton from './OutlineButton.astro';
import GradiGlow from './GradiGlow.astro';
import ColourFlowButton from './ColourFlowButton.astro';
import SlideColourButton from './SlideColourButton.astro';
import NeumorphicButton from './NeumorphicButton.astro';
import EmpowerButton from './EmpowerButton.astro';
import {
  BUTTON_STYLE,
  BUTTON_SIZE,
  BUTTON_RADIUS,
  BUTTON_VARIANT,
  type ButtonStyle
} from '../../functions/button-config';

export interface Props {
  // Which button style to use (overrides site default)
  style?: ButtonStyle;

  // Common button props
  variant?: 'primary' | 'secondary' | 'accent1' | 'accent2' | 'accent3' | 'accent4' | 'accent5';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  href?: string;
  className?: string;

  // BaseButton specific
  type?: 'button' | 'submit' | 'reset';
  shape?: 'default' | 'circle' | 'square';

  // OutlineButton specific
  label?: string;
  target?: string;
  radius?: 'sharp' | 'default' | 'soft' | 'pill';

  // GradiGlow / ColourFlow specific
  text?: string;

  // SlideColourButton specific
  icon?: 'plus' | 'animated-plus' | 'animated-star' | 'animated-chevron';

  // EmpowerButton specific
  cornerRadius?: 'sharp' | 'soft' | 'pill';
}

const {
  style = BUTTON_STYLE,
  variant = BUTTON_VARIANT,
  size = BUTTON_SIZE,
  disabled = false,
  href,
  className = '',
  type = 'button',
  shape = 'default',
  label,
  target = '_blank',
  radius = BUTTON_RADIUS,
  text,
  icon = 'plus',
  cornerRadius = BUTTON_RADIUS,
} = Astro.props;

// Get slot content for button text
const slotContent = await Astro.slots.render('default');
const buttonText = text || label || slotContent || 'Button';
---

<!-- data-unified-btn helps identify buttons using the unified system -->
<span class="unified-btn" data-unified-btn={style} data-variant={variant}>
  {style === 'base' && (
    <BaseButton
      variant={variant}
      size={size}
      disabled={disabled}
      type={type}
      shape={shape}
      className={className}
    >
      <Fragment set:html={buttonText} />
    </BaseButton>
  )}

  {style === 'outline' && (
    <OutlineButton
      variant={variant}
      size={size}
      disabled={disabled}
      href={href || '#'}
      target={target}
      radius={radius}
      label={typeof buttonText === 'string' ? buttonText : 'Button'}
      className={className}
    />
  )}

  {style === 'gradiglow' && (
    <GradiGlow
      variant={variant}
      size={size === 'md' ? undefined : size}
      disabled={disabled}
      href={href || '#'}
      text={typeof buttonText === 'string' ? buttonText : 'Button'}
      className={className}
    />
  )}

  {style === 'colourflow' && (
    <ColourFlowButton
      variant={variant}
      size={size}
      radius={radius}
      disabled={disabled}
      href={href || '#'}
      label={typeof buttonText === 'string' ? buttonText : 'Button'}
      target={target}
      shape={shape}
      className={className}
    />
  )}

  {style === 'slide' && (
    <SlideColourButton
      variant={variant}
      href={href || '#'}
      target={target}
      label={typeof buttonText === 'string' ? buttonText : 'Button'}
      icon={icon}
    />
  )}

  {style === 'neumorphic' && (
    <NeumorphicButton
      variant={variant}
      size={size}
      disabled={disabled}
      href={href || '#'}
      label={typeof buttonText === 'string' ? buttonText : 'Button'}
      shape={shape === 'circle' ? 'round' : shape}
      radius={radius}
    />
  )}

  {style === 'empower' && (
    <EmpowerButton
      variant="default"
      size={size}
      disabled={disabled}
      href={href || '#'}
      target={target as '_blank' | '_self' | '_parent' | '_top'}
      shape={shape === 'default' ? 'button' : shape}
      cornerRadius={cornerRadius === 'default' ? 'soft' : cornerRadius}
      class={className}
    >
      <Fragment set:html={buttonText} />
    </EmpowerButton>
  )}
</span>

<style>
  /* Wrapper is inline to not affect layout */
  .unified-btn {
    display: inline-block;
  }

  /* DEV MODE: Highlight unified buttons
     Add ?dev-buttons to URL or set data-dev-buttons on body to see which buttons are unified
     Unified buttons will have a green outline, hardcoded ones won't */
  :global(body[data-dev-buttons]) .unified-btn {
    outline: 2px dashed #22c55e !important;
    outline-offset: 4px;
  }

  /* Also highlight via URL param - use JS to detect */
</style>

<script>
  // Dev mode: Add data-dev-buttons to body if URL has ?dev-buttons
  if (typeof window !== 'undefined' && window.location.search.includes('dev-buttons')) {
    document.body.setAttribute('data-dev-buttons', 'true');
    console.log('%c[Button Audit] Dev mode enabled - Unified buttons have GREEN dashed outlines', 'color: #22c55e; font-weight: bold;');
    console.log('%c[Button Audit] Buttons WITHOUT green outline are hardcoded and need migration', 'color: #ef4444;');

    // Count buttons
    setTimeout(() => {
      const unifiedCount = document.querySelectorAll('[data-unified-btn]').length;
      const allButtons = document.querySelectorAll('button, a.btn, a.opb-button, a.rainbow-button, .btn, .opb-button').length;
      console.log(`%c[Button Audit] ${unifiedCount}/${allButtons} buttons using UnifiedButton system`, 'color: #3b82f6;');
    }, 1000);
  }
</script>
