---
// Product Card Component
// Used for displaying products, templates, downloads

export interface Props {
  id: string;
  name: string;
  description: string;
  price: number;
  currency?: string;
  image?: string;
  imageAlt?: string;
  category?: string;
  badge?: string; // "New", "Sale", "Popular", etc.
  rating?: number; // 1-5
  reviewCount?: number;
  href?: string;
  buttonText?: string;
  buttonVariant?: 'primary' | 'secondary' | 'outline';
  onSale?: boolean;
  originalPrice?: number;
  featured?: boolean;
  // Product type specific
  productType?: 'pdf_download' | 'service';
  pdfPath?: string;
  serviceType?: string;
}

const {
  id,
  name,
  description,
  price,
  currency = 'USD',
  image,
  imageAlt = name,
  category,
  badge,
  rating,
  reviewCount,
  href,
  buttonText = 'Add to Cart',
  buttonVariant = 'primary',
  onSale = false,
  originalPrice,
  featured = false,
  productType = 'pdf_download',
  pdfPath,
  serviceType
} = Astro.props;

const formattedPrice = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: currency,
}).format(price);

const formattedOriginalPrice = originalPrice ? new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: currency,
}).format(originalPrice) : null;
---

<article class={`product-card ${featured ? 'product-card--featured' : ''}`}>
  {href && (
    <a href={href} class="product-card__link">
      {image && (
        <div class="product-card__image">
          <img src={image} alt={imageAlt} loading="lazy" />
          {badge && (
            <span class={`product-card__badge ${onSale ? 'product-card__badge--sale' : ''}`}>
              {badge}
            </span>
          )}
        </div>
      )}
    </a>
  )}

  {!href && image && (
    <div class="product-card__image">
      <img src={image} alt={imageAlt} loading="lazy" />
      {badge && (
        <span class={`product-card__badge ${onSale ? 'product-card__badge--sale' : ''}`}>
          {badge}
        </span>
      )}
    </div>
  )}

  <div class="product-card__content">
    {category && (
      <span class="product-card__category">{category}</span>
    )}

    <h3 class="product-card__title">
      {href ? (
        <a href={href}>{name}</a>
      ) : (
        name
      )}
    </h3>

    <p class="product-card__description">{description}</p>

    {(rating || reviewCount) && (
      <div class="product-card__rating">
        {rating && (
          <div class="product-card__stars" aria-label={`${rating} out of 5 stars`}>
            {Array.from({ length: 5 }).map((_, i) => (
              <span class={i < rating ? 'star star--filled' : 'star'}>â˜…</span>
            ))}
          </div>
        )}
        {reviewCount && (
          <span class="product-card__reviews">({reviewCount})</span>
        )}
      </div>
    )}

    <div class="product-card__footer">
      <div class="product-card__pricing">
        {onSale && formattedOriginalPrice && (
          <span class="product-card__original-price">{formattedOriginalPrice}</span>
        )}
        <span class="product-card__price">{formattedPrice}</span>
      </div>

      <button
        class={`btn btn-sm btn-${buttonVariant} add-to-cart-btn`}
        data-product-id={id}
        data-product-name={name}
        data-product-price={price}
        data-product-image={image}
        data-product-type={productType}
        data-pdf-path={pdfPath}
        data-service-type={serviceType}
        type="button"
      >
        {buttonText}
      </button>
    </div>
  </div>
</article>

<style>
  .product-card {
    background: var(--color-Background-50);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .product-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }

  .product-card--featured {
    border: 2px solid var(--color-Primary-500);
  }

  .product-card__link {
    text-decoration: none;
    color: inherit;
  }

  .product-card__image {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;
    overflow: hidden;
    background: var(--color-Background-100);
  }

  .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-card__image img {
    transform: scale(1.05);
  }

  .product-card__badge {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    background: var(--color-Primary-600);
    color: var(--color-Background-50);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-card__badge--sale {
    background: var(--color-Secondary-600);
  }

  .product-card__content {
    padding: var(--space-lg);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    flex: 1;
  }

  .product-card__category {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-Primary-600);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-card__title {
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    color: var(--color-Text-900);
    margin: 0;
    line-height: 1.3;
  }

  .product-card__title a {
    text-decoration: none;
    color: inherit;
    transition: color 0.2s ease;
  }

  .product-card__title a:hover {
    color: var(--color-Primary-600);
  }

  .product-card__description {
    font-size: var(--text-sm);
    color: var(--color-Text-600);
    line-height: 1.6;
    margin: 0;
    flex: 1;
  }

  .product-card__rating {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .product-card__stars {
    display: flex;
    gap: 2px;
    color: var(--color-Background-300);
  }

  .star {
    font-size: var(--text-base);
  }

  .star--filled {
    color: var(--color-AccentFive-500);
  }

  .product-card__reviews {
    font-size: var(--text-sm);
    color: var(--color-Text-500);
  }

  .product-card__footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md);
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-Background-200);
  }

  .product-card__pricing {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .product-card__original-price {
    font-size: var(--text-sm);
    color: var(--color-Text-400);
    text-decoration: line-through;
  }

  .product-card__price {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    color: var(--color-Primary-700);
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .product-card__content {
      padding: var(--space-md);
    }

    .product-card__title {
      font-size: var(--text-base);
    }

    .product-card__price {
      font-size: var(--text-lg);
    }

    .product-card__footer {
      flex-direction: column;
      align-items: flex-start;
    }

    .product-card__footer .btn {
      width: 100%;
    }
  }
</style>
