---
/**
 * Product Card Component
 * With Add to Cart functionality
 */

export interface Props {
  id: string;
  name: string;
  description: string;
  price: number;
  image?: string;
  images?: string[];
}

const {
  id,
  name,
  description,
  price,
  image = 'https://placehold.co/200x100',
  images = []
} = Astro.props;
---

<div class="product-card" data-product-id={id}>
  <img src={image} alt={name} class="product-card__image" />
  <h2 class="product-card__name">{name}</h2>
  <p class="product-card__description">{description}</p>
  <p class="product-card__price">${price.toFixed(2)}</p>
  <button class="product-card__add-btn" data-product-id={id}>
    Add to cart
  </button>
</div>

<style>
  .product-card {
    position: relative;
    overflow: hidden;
    width: 200px;
    height: 280px;
    display: inline-block;
    border-radius: var(--border-radius-lg);
    background: var(--color-Background-100);
    margin: var(--space-lg);
    padding: var(--space-md);
    box-shadow: var(--shadow-md);
    transition: transform var(--transition-base), box-shadow var(--transition-base);
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
  }

  .product-card__image {
    position: relative;
    top: calc(-1 * var(--space-md));
    left: calc(-1 * var(--space-md));
    width: calc(100% + var(--space-lg) + var(--space-md));
    height: 120px;
    object-fit: cover;
    border-top-left-radius: var(--border-radius-lg);
    border-top-right-radius: var(--border-radius-lg);
    transition: all var(--transition-base);
    clip-path: polygon(0 100%, 0 0, 100% 0, 100% 70%);
  }

  .product-card:hover .product-card__image {
    clip-path: polygon(0 100%, 0 0, 100% 0, 100% 100%);
    transform: scale(1.05);
  }

  .product-card__name {
    text-align: left;
    color: var(--color-Text-700);
    font-size: var(--text-sm);
    font-weight: var(--font-bold);
    font-family: var(--font-heading);
    margin-bottom: var(--space-xs);
  }

  .product-card__description {
    text-align: left;
    font-size: var(--text-xs);
    color: var(--color-Text-600);
    font-family: var(--font-body);
    max-height: 33px;
    overflow: hidden;
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-sm);
  }

  .product-card__price {
    text-align: right;
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    color: var(--color-Primary-500);
    margin-top: var(--space-sm);
    margin-bottom: var(--space-md);
  }

  .product-card__add-btn {
    position: absolute;
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    padding: var(--space-sm) var(--space-lg);
    border: 2px solid var(--color-Primary-500);
    border-radius: var(--border-radius-full);
    bottom: var(--space-md);
    right: var(--space-md);
    background: transparent;
    color: var(--color-Primary-500);
    cursor: pointer;
    overflow: hidden;
    transition: all var(--transition-base);
  }

  .product-card__add-btn:hover {
    background: var(--color-Primary-500);
    color: white;
    padding-right: var(--space-xl);
  }

  .product-card__add-btn:hover::after {
    content: " ðŸ›’";
    margin-left: var(--space-xs);
  }

  .product-card__add-btn--added {
    background: var(--color-AccentTwo-500);
    border-color: var(--color-AccentTwo-500);
    color: white;
  }

  .product-card__add-btn--added::after {
    content: " âœ“";
    margin-left: var(--space-xs);
  }
</style>

<script>
  document.querySelectorAll('.product-card__add-btn').forEach(button => {
    button.addEventListener('click', function(this: HTMLElement) {
      const card = this.closest('.product-card');
      if (!card) return;

      const id = card.getAttribute('data-product-id') || '';
      const name = card.querySelector('.product-card__name')?.textContent || '';
      const priceText = card.querySelector('.product-card__price')?.textContent || '$0';
      const price = parseFloat(priceText.replace('$', ''));
      const image = (card.querySelector('.product-card__image') as HTMLImageElement)?.src;

      if (typeof (window as any).addToCart === 'function') {
        (window as any).addToCart({
          id,
          name,
          price,
          image
        });

        // Visual feedback
        this.classList.add('product-card__add-btn--added');
        setTimeout(() => {
          this.classList.remove('product-card__add-btn--added');
        }, 1500);
      }
    });
  });
</script>
