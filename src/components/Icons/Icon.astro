---
/**
 * Icon component - Loads SVG icons from local Phosphor icons folder
 *
 * Usage:
 * <Icon name="sparkle-fill" size={24} />
 * <Icon name="wellness/heart-fill" size={20} />
 * <Icon name="ph:heart-duotone" size={20} /> (legacy - maps to fill)
 *
 * Icons stored in: /public/Icons/phosphor/[category]/
 * Categories: nature, wellness, objects, interface, communication, people, creative, shapes, a11y, a11y-panel, spec-cards
 * Download from: https://phosphoricons.com/
 */
import fs from 'node:fs';
import path from 'node:path';

interface Props {
  name: string;
  size?: number;
  class?: string;
}

const { name, size = 24, class: className = '' } = Astro.props;

// Strip 'ph:' prefix if present (for backwards compatibility)
let iconName = name.startsWith('ph:') ? name.slice(3) : name;

// Convert duotone/regular to fill style (we use fill for better a11y)
iconName = iconName.replace(/-duotone$/, '-fill').replace(/-regular$/, '-fill');

// Icon categories to search through
const categories = ['nature', 'wellness', 'objects', 'interface', 'communication', 'people', 'creative', 'shapes', 'a11y', 'a11y-panel', 'contact-popup', 'announcement-ticker', 'toast', 'spec-cards', 'badges', 'trust'];

// Try to load local SVG
let iconContent: string | null = null;

// Function to try loading from a path
const tryLoadIcon = (iconPath: string): string | null => {
  try {
    const fullPath = path.join(process.cwd(), 'public', iconPath);
    if (fs.existsSync(fullPath)) {
      return fs.readFileSync(fullPath, 'utf-8');
    }
  } catch {
    // Silent fail
  }
  return null;
};

// If path already includes a folder (e.g., "wellness/heart-fill"), use directly
if (iconName.includes('/')) {
  iconContent = tryLoadIcon(`/Icons/phosphor/${iconName}.svg`);
} else {
  // Search through categories
  for (const category of categories) {
    iconContent = tryLoadIcon(`/Icons/phosphor/${category}/${iconName}.svg`);
    if (iconContent) break;
  }
}

// Fallback icon (simple circle)
const fallbackIcon = `<svg viewBox="0 0 256 256" width="${size}" height="${size}" fill="currentColor"><circle cx="128" cy="128" r="96" opacity="0.2"/><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-width="16"/></svg>`;
---

<span
  class={`icon ${className}`}
  style={`width: ${size}px; height: ${size}px;`}
  set:html={iconContent || fallbackIcon}
/>

<style>
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: inherit;
  }

  .icon :global(svg) {
    width: 100%;
    height: 100%;
    fill: currentColor;
  }
</style>
