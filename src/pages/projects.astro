---
import BaseLayout from '../Layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FooterWithMask from '../components/Footer/FooterWithMask.astro';
import Button from '../components/Button/Button.astro';
import HeroSection from '../components/Sections/HeroSection.astro';
import ScrollColorBackground from '../components/Scroll/ScrollColorBackground.astro';
import ProjectCard from '../components/Cards/ProjectCard.astro';

// Import data
import heroDataRaw from '../data/projects/hero.json';
import infoDataRaw from '../data/projects/info.json';

// Type assertions for JSON imports
const heroData = heroDataRaw as {
  title: string;
  subtitle: string;
  extraText: string;
  variant: 'simple' | 'image' | 'gradient';
};

const infoData = infoDataRaw as {
  title: string;
  paragraphs: string[];
  ctaText: string;
  ctaHref: string;
  ctaVariant: 'primary' | 'secondary';
};

// Helper to get folder slug from entry.id (handles index.md suffix and path separators)
const getSlug = (id: string) => {
  const normalized = id.replace(/[\\/]index\.md$/, '');
  return normalized.split(/[\\/]/).pop() || id;
};

// Get projects from content collection
const projectEntries = await getCollection('projects');
const projects = projectEntries.map(entry => ({
  slug: getSlug(entry.id),
  ...entry.data,
}));

// Define scroll background colors for each project
const scrollColors = [
  'var(--color-AccentOne-300)',
  'var(--color-AccentTwo-400)',
  'var(--color-AccentThree-300)',
];
---

<BaseLayout
  title="Projects | Walking With A Smile"
  description="Free curated resource collections. Each project brings together carefully selected resources for a specific purpose, available to everyone."
  hideFooter={true}
>
  <!-- Scroll-triggered background color component -->
  <ScrollColorBackground />

  <!-- Hero Section -->
  <div data-scroll-bg="var(--color-Background-100)">
    <HeroSection
      title={heroData.title}
      subtitle={heroData.subtitle}
      extraText={heroData.extraText}
      variant={heroData.variant}
    />
  </div>

  <!-- Projects Sections -->
  {projects.map((project, index) => {
    const scrollBg = scrollColors[index % scrollColors.length];
    const imagePosition = index % 2 === 0 ? 'left' : 'right';
    return (
      <ProjectCard
        slug={project.slug}
        title={project.title}
        description={project.description}
        category={project.category}
        cardImage={project.cardImage}
        scrollBg={scrollBg}
        imagePosition={imagePosition}
      />
    );
  })}

  <!-- Info Section -->
  <section class="info-section" data-scroll-bg="var(--color-Background-100)">
    <div class="container container-full">
      <div class="info-content">
        <h2 class="info-title">{infoData.title}</h2>
        <div class="info-text">
          {infoData.paragraphs.map((paragraph) => (
            <p>{paragraph}</p>
          ))}
        </div>
        <div class="info-cta">
          <Button href={infoData.ctaHref} variant={infoData.ctaVariant}>
            {infoData.ctaText}
          </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer with Interactive Mask -->
  <FooterWithMask />
</BaseLayout>
